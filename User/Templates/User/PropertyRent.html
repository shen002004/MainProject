<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PROPERTY RENTING</title>
    <script>
    window.onload = function () {
        const today = new Date().toISOString().split('T')[0];
        document.getElementById("fromdate").setAttribute("min", today);
    };

    function calculateAmount() {
        const fromDate = document.getElementById("fromdate").value;
        const toDate = document.getElementById("todate").value;
        const monthlyPrice = document.getElementById("price").value;

        if (fromDate) {
            const from = new Date(fromDate);
            const minToDate = new Date(from);
            minToDate.setDate(minToDate.getDate() + 30);

            const minToDateStr = minToDate.toISOString().split('T')[0];
            document.getElementById("todate").setAttribute("min", minToDateStr);
        }

        if (fromDate && toDate && monthlyPrice) {
            const start = new Date(fromDate);
            const end = new Date(toDate);

            const diffTime = end - start;
            const days = diffTime / (1000 * 60 * 60 * 24);

            document.getElementById("days").value = days;

            if (days >= 30) {
                const pricePerDay = monthlyPrice / 30;
                document.getElementById("amount").value = Math.round(days * pricePerDay);
            } else {
                document.getElementById("amount").value = "";
            }
        }
    }
</script>


</head>

<body>
    <form action="" method="post">
        {% csrf_token %}
        <table border="1" align="center">
            <tr>
                <td>From Date</td>
                <td>
                    <input type="date" name="txt_fromdate" id="fromdate" onchange="calculateAmount()">
                </td>
            </tr>
            <tr>
                <td>To Date</td>
                <td>
                    <input type="date" name="txt_todate" id="todate" onchange="calculateAmount()">
                    <input type="hidden" name="txt_days" id="days">
                </td>
            </tr>
            <tr>
                <td>Amount</td>
                <td>
                    <input type="number" name="txt_Amount" id="amount" readonly>
                </td>
            </tr>
            <tr>
                <td>One Month Price</td>
                <td><input type="number" name="txt_price" id="price" value="{{ppt.property_price}}" readonly
                        oninput="calculateAmount()"></td>
            </tr>
            <tr>
                <td colspan="2" align="center">
                    <input type="submit" value="Book">
                </td>
            </tr>
        </table>
    </form>
</body>

</html>



{% if msg %}
<script>
    alert("{{msg}}");
    window.location = "{% url 'User:Viewpro'%}"
</script>
{% endif %}